<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" th:replace="~{fragmentos/layout :: layout(~{::section})}">
<section class="space-y-6">
    <div class="flex items-center justify-between">
        <h1 class="text-3xl font-extrabold tracking-tight text-slate-800 dark:text-slate-100 md:text-5xl">Movimentacoes de Estoque</h1>
    </div>

    <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900/90 dark:shadow-black/20">
        <h2 class="mb-3 text-lg font-semibold text-slate-800 dark:text-slate-100">Buscar Produto</h2>
        <form class="grid grid-cols-1 gap-3 md:grid-cols-[2fr_1fr_auto_auto]" method="get" th:action="@{/estoque/movimentacoes}">
            <input class="h-11 rounded-xl border border-slate-200 bg-white px-4 text-lg text-slate-700 outline-none transition focus:border-indigo-400 dark:border-slate-700 dark:bg-slate-950/60 dark:text-slate-100"
                   type="text"
                   name="nomeProduto"
                   placeholder="Buscar por nome ou bipar codigo..."
                   th:value="${nomeProduto}"
                   autocomplete="off"
                   autofocus />
            <select class="h-11 rounded-xl border border-slate-200 bg-white px-3 text-base text-slate-600 outline-none transition focus:border-indigo-400 dark:border-slate-700 dark:bg-slate-950/60 dark:text-slate-100" name="categoriaId">
                <option value="" th:selected="${categoriaId == null}">Todas categorias</option>
                <option th:each="categoria : ${categorias}" th:value="${categoria.id}" th:text="${categoria.nome}" th:selected="${categoriaId == categoria.id}"></option>
            </select>
            <button class="h-11 rounded-xl bg-slate-800 px-4 text-sm font-semibold text-white transition hover:bg-slate-700 dark:bg-indigo-600 dark:hover:bg-indigo-500" type="submit">Buscar</button>
            <a class="inline-flex h-11 items-center justify-center rounded-xl bg-slate-100 px-4 text-sm font-semibold text-slate-700 transition hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-200 dark:hover:bg-slate-700"
               th:href="@{/estoque/movimentacoes}">Limpar</a>
        </form>
    </div>

    <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900/90 dark:shadow-black/20">
        <h2 class="mb-3 text-lg font-semibold text-slate-800 dark:text-slate-100">Registrar Movimentacao</h2>
        <form class="grid grid-cols-1 gap-3 md:grid-cols-4" method="post" th:action="@{/estoque/movimentacoes}">
            <input type="hidden" name="nomeProduto" th:value="${nomeProduto}" />
            <input th:if="${categoriaId != null}" type="hidden" name="categoriaId" th:value="${categoriaId}" />

            <select class="h-11 rounded-xl border border-slate-200 bg-white px-3 text-base text-slate-700 dark:border-slate-700 dark:bg-slate-950/60 dark:text-slate-100" name="produtoId" required>
                <option value="">Selecione o produto</option>
                <option th:each="produto : ${produtos}" th:value="${produto.id}" th:text="${produto.nome + ' (' + produto.codigo + ')'}"></option>
            </select>
            <select class="h-11 rounded-xl border border-slate-200 bg-white px-3 text-base text-slate-700 dark:border-slate-700 dark:bg-slate-950/60 dark:text-slate-100" name="tipo" required>
                <option th:each="tipo : ${tipos}" th:value="${tipo}" th:text="${tipo}"></option>
            </select>
            <input class="h-11 rounded-xl border border-slate-200 bg-white px-3 text-base text-slate-700 dark:border-slate-700 dark:bg-slate-950/60 dark:text-slate-100" type="number" name="quantidade" min="1" value="1" required />
            <input class="h-11 rounded-xl border border-slate-200 bg-white px-3 text-base text-slate-700 dark:border-slate-700 dark:bg-slate-950/60 dark:text-slate-100" type="text" name="motivo" placeholder="Motivo" required />
            <button class="rounded-xl bg-indigo-600 px-4 py-3 text-base font-semibold text-white shadow-lg shadow-indigo-900/20 transition hover:bg-indigo-500 dark:shadow-black/30 md:col-span-4" type="submit">Salvar</button>
        </form>
        <p th:if="${#lists.isEmpty(produtos)}" class="mt-3 rounded-xl border border-dashed border-slate-300 bg-slate-50 p-3 text-sm text-slate-500 dark:border-slate-700 dark:bg-slate-800/80 dark:text-slate-400">
            Nenhum produto encontrado para os filtros informados.
        </p>
    </div>

    <div class="overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-900/90 dark:shadow-black/20">
        <div class="max-h-[52vh] overflow-auto">
            <table class="min-w-full">
                <thead class="sticky top-0 bg-slate-50 dark:bg-slate-800">
                <tr class="border-b text-left text-sm font-bold uppercase tracking-wide text-slate-500 dark:border-slate-700 dark:text-slate-300">
                    <th class="p-3">Data</th>
                    <th class="p-3">Produto</th>
                    <th class="p-3">Tipo</th>
                    <th class="p-3">Quantidade</th>
                    <th class="p-3">Motivo</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="mov : ${movimentacoes}" class="border-b border-slate-100 text-slate-700 transition-colors hover:bg-slate-50 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800/60">
                    <td class="p-3" th:text="${mov.dataMovimentacao}"></td>
                    <td class="p-3" th:text="${mov.produto.nome}"></td>
                    <td class="p-3" th:text="${mov.tipo}"></td>
                    <td class="p-3" th:text="${mov.quantidade}"></td>
                    <td class="p-3" th:text="${mov.motivo}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>
</html>
