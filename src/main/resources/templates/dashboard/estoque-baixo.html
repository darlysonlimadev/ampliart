<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" th:replace="~{fragmentos/layout :: layout(~{::section})}">
<section class="space-y-6">
    <div class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
        <div>
            <h1 class="text-3xl font-extrabold tracking-tight text-slate-800 dark:text-slate-100 md:text-5xl">Produtos com Estoque Baixo</h1>
            <p class="mt-2 text-base text-slate-500 dark:text-slate-400">Acompanhe itens criticos para reposicao e evite ruptura nas vendas.</p>
        </div>
        <a th:href="@{/estoque/movimentacoes}" class="inline-flex h-11 items-center rounded-xl bg-indigo-600 px-5 text-sm font-semibold text-white shadow-lg shadow-indigo-900/20 transition hover:bg-indigo-500 dark:shadow-black/30">
            Registrar Reposicao
        </a>
    </div>

    <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900/90 dark:shadow-black/20">
        <form class="grid grid-cols-1 gap-3 md:grid-cols-[240px_auto] md:items-end" method="get" th:action="@{/dashboard/estoque-baixo}">
            <div>
                <label class="mb-1 block text-sm font-semibold text-slate-600 dark:text-slate-300">Limite de estoque</label>
                <input class="h-11 w-full rounded-xl border border-slate-200 bg-white px-3 text-slate-700 dark:border-slate-700 dark:bg-slate-950/60 dark:text-slate-100" type="number" name="limite" min="1" th:value="${limite}" />
            </div>
            <button class="h-11 rounded-xl bg-slate-800 px-4 text-sm font-semibold text-white transition hover:bg-slate-700 dark:bg-slate-700 dark:hover:bg-slate-600" type="submit">Aplicar filtro</button>
        </form>
        <p class="mt-3 text-sm text-slate-500 dark:text-slate-400">
            Produtos encontrados: <strong class="text-slate-700 dark:text-slate-100" th:text="${totalProdutosBaixo}"></strong>
        </p>
    </div>

    <div class="overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-900/90 dark:shadow-black/20">
        <div class="max-h-[66vh] overflow-auto">
            <table class="min-w-full">
                <thead class="sticky top-0 bg-slate-50 dark:bg-slate-800">
                <tr class="text-left text-sm font-bold uppercase tracking-wide text-slate-500 dark:text-slate-300">
                    <th class="px-4 py-4">Produto</th>
                    <th class="px-4 py-4">Categoria</th>
                    <th class="px-4 py-4">Codigo</th>
                    <th class="px-4 py-4">Estoque</th>
                    <th class="px-4 py-4">Preco Venda</th>
                    <th class="px-4 py-4">Acoes</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="produto : ${produtosEstoqueBaixo}" class="border-t border-slate-100 text-base text-slate-700 dark:border-slate-700 dark:text-slate-300">
                    <td class="px-4 py-4 font-semibold text-slate-800 dark:text-slate-100" th:text="${produto.nome}"></td>
                    <td class="px-4 py-4" th:text="${produto.categoria != null ? produto.categoria.nome : '-'}"></td>
                    <td class="px-4 py-4 font-mono text-sm text-slate-600 dark:text-slate-300" th:text="${produto.codigo}"></td>
                    <td class="px-4 py-4">
                        <span class="rounded-full bg-rose-100 px-3 py-1 text-sm font-bold text-rose-700 dark:bg-rose-500/20 dark:text-rose-200" th:text="${produto.quantidadeEstoque}"></span>
                    </td>
                    <td class="px-4 py-4 font-semibold" th:text="'R$ ' + ${#numbers.formatDecimal(produto.precoVenda, 1, 2)}"></td>
                    <td class="px-4 py-4">
                        <div class="flex gap-2">
                            <a class="inline-flex rounded-lg bg-slate-100 px-3 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-200 dark:hover:bg-slate-700" th:href="@{/produtos/{id}/editar(id=${produto.id})}">Editar</a>
                            <a class="inline-flex rounded-lg bg-indigo-100 px-3 py-2 text-sm font-semibold text-indigo-700 transition hover:bg-indigo-200 dark:bg-indigo-500/20 dark:text-indigo-200 dark:hover:bg-indigo-500/30" th:href="@{/estoque/movimentacoes(nomeProduto=${produto.codigo})}">Repor</a>
                        </div>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(produtosEstoqueBaixo)}">
                    <td colspan="6" class="px-4 py-10 text-center text-slate-500 dark:text-slate-400">Nenhum produto com estoque baixo para o limite informado.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>
</html>
